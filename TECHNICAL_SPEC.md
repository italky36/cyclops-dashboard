# Техническое задание
## Доработка Cyclops Dashboard для полноценной работы с API

**Версия:** 1.1  
**Дата:** 26.01.2026  
**Статус:** Черновик

---

## 1. Текущее состояние

### 1.1 Реализованный функционал

| Модуль | Функционал | Статус |
|--------|-----------|--------|
| **Авторизация API** | RSA подпись запросов согласно документации Cyclops | ✅ Готово |
| **Управление ключами** | Загрузка через UI (текст/файл), валидация, шифрованное хранение | ✅ Готово |
| **Переключение слоёв** | PRE/PROD, индикаторы статуса подключения | ✅ Готово |
| **Бенефициары** | Создание ЮЛ/ИП/ФЛ, список с фильтрами, активация/деактивация | ✅ Готово |
| **Виртуальные счета** | Создание, список с балансами, переводы между счетами | ✅ Готово |
| **Сделки** | Создание с несколькими получателями, список, исполнение, отмена | ✅ Готово |
| **Платежи** | Список входящих/исходящих, идентификация | ✅ Готово |
| **Настройки** | Конфигурация ключей, тест подключения, генерация ключей | ✅ Готово |

### 1.2 Текущее хранение данных

```
┌─────────────────────────────────────────────────────────────────┐
│                    ТЕКУЩАЯ АРХИТЕКТУРА ДАННЫХ                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    Зашифрованные RSA ключи                │
│  │  .keys/*.enc    │    AES-256-GCM + PBKDF2                   │
│  │  (файловая      │    Мастер-пароль из ENV                   │
│  │   система)      │                                           │
│  └─────────────────┘                                           │
│                                                                 │
│  ┌─────────────────┐    UI состояние (Zustand + localStorage)  │
│  │  localStorage   │    • Текущий слой (pre/prod)              │
│  │  (браузер)      │    • Статус подключения                   │
│  │                 │    • Правила автоплатежей (только UI)     │
│  │                 │    • Избранные бенефициары                │
│  │                 │    • История последних действий           │
│  └─────────────────┘                                           │
│                                                                 │
│  ┌─────────────────┐    Бизнес-данные                          │
│  │  Cyclops API    │    • Бенефициары                          │
│  │  (внешний)      │    • Виртуальные счета                    │
│  │                 │    • Сделки и платежи                     │
│  │  НЕ КЭШИРУЕТСЯ  │    Запрашиваются при каждом обращении     │
│  └─────────────────┘                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### Проблемы текущей архитектуры:
1. **Нет локальной БД** — данные не кэшируются, каждый запрос идёт в API
2. **Правила автоплатежей** — хранятся только в браузере, не работают реально
3. **Нет аудита** — история операций теряется при очистке браузера
4. **Нет webhook'ов** — система не получает уведомления от Cyclops

### 1.3 Реализованные API методы

| Метод | Описание | Статус |
|-------|----------|--------|
| `echo` | Тест подключения | ✅ |
| `create_beneficiary_ul` | Создание бенефициара ЮЛ | ✅ |
| `create_beneficiary_ip` | Создание бенефициара ИП | ✅ |
| `create_beneficiary_fl` | Создание бенефициара ФЛ | ✅ |
| `list_beneficiary` | Список бенефициаров | ✅ |
| `activate_beneficiary` | Активация бенефициара | ✅ |
| `deactivate_beneficiary` | Деактивация бенефициара | ✅ |
| `create_virtual_account` | Создание виртуального счёта | ✅ |
| `list_virtual_account` | Список виртуальных счетов | ✅ |
| `get_virtual_account` | Детали счёта | ✅ |
| `create_deal` | Создание сделки | ✅ |
| `list_deals` | Список сделок | ✅ |
| `execute_deal` | Исполнение сделки | ✅ |
| `rejected_deal` | Отмена сделки | ✅ |
| `list_payments_v2` | Список платежей | ✅ |
| `identification_payment` | Идентификация платежа | ✅ |
| `list_banks_sbp` | Список банков СБП | ✅ |

### 1.4 Архитектура приложения

```
┌─────────────────────────────────────────────────────────────┐
│                      Frontend (Next.js 14)                   │
├─────────────────────────────────────────────────────────────┤
│  Pages:                                                      │
│  • /                    — Дашборд со статистикой            │
│  • /beneficiaries       — Список бенефициаров               │
│  • /beneficiaries/new   — Создание бенефициара              │
│  • /virtual-accounts    — Виртуальные счета                 │
│  • /deals               — Список сделок                     │
│  • /deals/new           — Создание сделки                   │
│  • /payments            — Платежи и идентификация           │
│  • /settings            — Настройки и ключи                 │
│                                                              │
│  Components: Sidebar, LayerSwitcher, Forms, Tables, Modals  │
│  State: Zustand (layer, connectionStatus, rules, actions)   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    API Routes (Next.js)                      │
├─────────────────────────────────────────────────────────────┤
│  /api/cyclops  — Прокси к Cyclops API с подписью            │
│  /api/keys     — Управление RSA ключами                     │
│  /api/settings — Конфигурация приложения                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Cyclops API (Точка Банк)                │
├─────────────────────────────────────────────────────────────┤
│  PRE:  https://pre.tochka.com/api/v1/cyclops/v2/jsonrpc     │
│  PROD: https://api.tochka.com/api/v1/cyclops/v2/jsonrpc     │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. Требования к доработке (НЕ РЕАЛИЗОВАНО)

### 2.1 Загрузка документов

**Приоритет:** Высокий  
**Оценка:** 8 часов

#### Описание
Cyclops требует загрузки документов для бенефициаров и сделок. Используется отдельный endpoint с multipart/form-data.

#### Endpoints
- `/upload_document/beneficiary` — документы бенефициара
- `/upload_document/deal` — документы сделки

#### Поддерживаемые форматы
- PDF (`application/pdf`)
- Изображения: JPEG, PNG, GIF, TIFF, BMP

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.1.1 | API Route для загрузки | POST `/api/documents/upload` с multipart/form-data |
| 2.1.2 | Подпись документов | Подписывать бинарное тело файла (не JSON) |
| 2.1.3 | UI компонент загрузки | Drag-and-drop зона, превью, прогресс |
| 2.1.4 | Список документов | Получение списка загруженных документов |
| 2.1.5 | Интеграция в формы | Добавить загрузку в создание бенефициара/сделки |

#### Технические требования
```typescript
// API для загрузки документа
interface UploadDocumentRequest {
  entityType: 'beneficiary' | 'deal';
  entityId: string;
  documentType: string;
  file: File;
}

// Заголовки запроса
headers: {
  'Content-Type': file.type, // application/pdf, image/jpeg и т.д.
  'sign-data': signature,
  'sign-thumbprint': thumbprint,
  'sign-system': system,
}
```

---

### 2.2 СБП (Система быстрых платежей)

**Приоритет:** Высокий  
**Оценка:** 6 часов

#### Описание
Реализовать полноценную работу с СБП: генерация QR-кодов для приёма платежей, список банков-участников.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.2.1 | Список банков СБП | Метод `list_banks_sbp`, кэширование на клиенте |
| 2.2.2 | Генерация QR-кода | Метод `generate_qr_sbp` для входящих платежей |
| 2.2.3 | UI страница СБП | Отдельная страница `/sbp` с формой генерации |
| 2.2.4 | Отображение QR | Рендеринг QR-кода, кнопка скачивания |
| 2.2.5 | История QR-кодов | Список сгенерированных QR с статусами оплаты |

#### Технические требования
```typescript
// Генерация QR-кода
interface GenerateQRRequest {
  virtual_account: string;
  amount: number;
  purpose?: string;
  ttl?: number; // время жизни в секундах
}

interface GenerateQRResponse {
  qr_id: string;
  qr_url: string;
  qr_image_base64: string;
  expires_at: string;
}
```

---

### 2.3 Шифрование номера карты

**Приоритет:** Высокий  
**Оценка:** 4 часа

#### Описание
Для выплат на карту номер карты должен быть зашифрован публичным ключом Cyclops (RSA OAEP).

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.3.1 | Хранение публичных ключей | Ключи PRE и PROD из документации |
| 2.3.2 | Функция шифрования | RSA OAEP шифрование на сервере |
| 2.3.3 | Валидация номера карты | Проверка длины (13-19 цифр), алгоритм Луна |
| 2.3.4 | Интеграция в форму сделки | Шифровать перед отправкой |

#### Публичные ключи Cyclops
```
PRE:  [получить из документации по ссылке]
PROD: [получить из документации по ссылке]
```

#### Технические требования
```typescript
// Шифрование карты (Python пример из документации)
function encryptCardNumber(cardNumber: string, publicKey: string): string {
  // 1. Удалить пробелы
  // 2. Проверить что 13-19 цифр
  // 3. Зашифровать RSA OAEP
  // 4. Вернуть base64
}
```

---

### 2.4 Webhook'и (Уведомления)

**Приоритет:** Высокий  
**Оценка:** 12 часов

#### Описание
Cyclops отправляет уведомления о событиях (новые платежи, изменение статусов). Необходимо реализовать приём и обработку webhook'ов.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.4.1 | Endpoint для webhook'ов | POST `/api/webhooks/cyclops` |
| 2.4.2 | Верификация подписи | Проверка что запрос от Cyclops |
| 2.4.3 | Обработчики событий | Роутинг по типам событий |
| 2.4.4 | Очередь обработки | Async обработка для надёжности |
| 2.4.5 | Логирование | Сохранение всех входящих webhook'ов |
| 2.4.6 | UI уведомлений | Real-time уведомления в интерфейсе |
| 2.4.7 | Настройка URL в Cyclops | Документация по настройке |

#### Типы событий
- `payment.created` — новый входящий платёж
- `payment.identified` — платёж идентифицирован
- `deal.status_changed` — изменение статуса сделки
- `beneficiary.status_changed` — изменение статуса бенефициара

#### Технические требования
```typescript
// Структура webhook
interface CyclopsWebhook {
  event_type: string;
  event_id: string;
  timestamp: string;
  data: Record<string, unknown>;
  signature: string;
}

// Обработчик
async function handleWebhook(webhook: CyclopsWebhook) {
  // 1. Верифицировать подпись
  // 2. Проверить идемпотентность (event_id)
  // 3. Обработать событие
  // 4. Вернуть 200 OK
}
```

---

### 2.5 Детальные страницы

**Приоритет:** Средний  
**Оценка:** 10 часов

#### Описание
Добавить страницы детального просмотра сущностей с полной информацией и возможностью действий.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.5.1 | Страница бенефициара | `/beneficiaries/[id]` — полная информация, документы, счета |
| 2.5.2 | Страница сделки | `/deals/[id]` — детали, получатели, статусы, документы |
| 2.5.3 | Страница платежа | `/payments/[id]` — полная информация, история |
| 2.5.4 | Страница виртуального счёта | `/virtual-accounts/[id]` — баланс, история операций |
| 2.5.5 | Breadcrumbs навигация | Хлебные крошки на всех страницах |

#### UI требования
- Карточка с основной информацией
- Таблица связанных сущностей
- Timeline истории изменений
- Кнопки действий (активировать, деактивировать, и т.д.)

---

### 2.6 Валидация данных

**Приоритет:** Средний  
**Оценка:** 6 часов

#### Описание
Реализовать клиентскую и серверную валидацию согласно правилам Cyclops.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.6.1 | Валидация ИНН | Алгоритм контрольной суммы (10 и 12 знаков) |
| 2.6.2 | Валидация КПП | 9 цифр, формат |
| 2.6.3 | Валидация счёта | 20 цифр, соответствие ИНН и конто |
| 2.6.4 | Валидация БИК | 9 цифр |
| 2.6.5 | Валидация телефона СБП | Формат 7XXXXXXXXXX |
| 2.6.6 | Валидация карты | Алгоритм Луна, 13-19 цифр |
| 2.6.7 | Библиотека валидаторов | Переиспользуемые функции |
| 2.6.8 | Интеграция в формы | Real-time валидация при вводе |

#### Алгоритм проверки ИНН (из документации)
```typescript
function validateINN(inn: string): boolean {
  if (inn.length === 10) {
    // Весовые коэффициенты: 2,4,10,3,5,9,4,6,8,0
    // Контрольная сумма mod 11
  } else if (inn.length === 12) {
    // Две проверки с разными коэффициентами
  }
  return false;
}
```

---

### 2.7 Автоматизация и правила

**Приоритет:** Средний  
**Оценка:** 16 часов

#### Описание
Реализовать систему автоматических действий по триггерам.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.7.1 | Модель правил | Хранение правил в БД/файле |
| 2.7.2 | UI создания правил | Форма с условиями и действиями |
| 2.7.3 | Триггер: входящий платёж | Автоидентификация по шаблону |
| 2.7.4 | Триггер: порог баланса | Действие при превышении суммы |
| 2.7.5 | Триггер: расписание | Cron-подобное выполнение |
| 2.7.6 | Действие: создать сделку | Автоматическое создание выплаты |
| 2.7.7 | Действие: уведомление | Email/Telegram при событии |
| 2.7.8 | Логирование выполнения | История срабатываний правил |
| 2.7.9 | Background worker | Фоновая обработка правил |

#### Структура правила
```typescript
interface AutomationRule {
  id: string;
  name: string;
  enabled: boolean;
  layer: 'pre' | 'prod';
  
  trigger: {
    type: 'incoming_payment' | 'balance_threshold' | 'schedule';
    conditions: Record<string, unknown>;
  };
  
  action: {
    type: 'create_deal' | 'identify_payment' | 'notify';
    params: Record<string, unknown>;
  };
  
  createdAt: string;
  lastExecutedAt?: string;
  executionCount: number;
}
```

---

### 2.8 Отчёты и аналитика

**Приоритет:** Низкий  
**Оценка:** 12 часов

#### Описание
Добавить раздел с отчётами и аналитикой по операциям.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.8.1 | Дашборд статистики | Графики оборота, количества операций |
| 2.8.2 | Отчёт по платежам | Фильтры, группировка, экспорт |
| 2.8.3 | Отчёт по сделкам | Статусы, суммы, получатели |
| 2.8.4 | Отчёт по бенефициарам | Активные, обороты, лимиты |
| 2.8.5 | Экспорт в Excel | Генерация XLSX файлов |
| 2.8.6 | Экспорт в PDF | Генерация PDF отчётов |
| 2.8.7 | Период и фильтры | Выбор дат, типов, статусов |

---

### 2.9 Обработка ошибок и retry

**Приоритет:** Средний  
**Оценка:** 6 часов

#### Описание
Улучшить обработку ошибок API и добавить механизм повторных попыток.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.9.1 | Типизация ошибок Cyclops | Enum кодов ошибок из документации |
| 2.9.2 | Человекочитаемые сообщения | Перевод кодов ошибок на русский |
| 2.9.3 | Retry механизм | Exponential backoff для сетевых ошибок |
| 2.9.4 | Offline режим | Очередь запросов при потере связи |
| 2.9.5 | UI индикаторы | Toast уведомления об ошибках |
| 2.9.6 | Страница ошибок | Красивые страницы 404, 500 |

---

### 2.10 Логирование и аудит

**Приоритет:** Средний  
**Оценка:** 8 часов

#### Описание
Реализовать систему логирования всех операций для аудита.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.10.1 | Модель лога | Структура записи аудита |
| 2.10.2 | Логирование API вызовов | Запись всех запросов к Cyclops |
| 2.10.3 | Логирование действий UI | Действия пользователя |
| 2.10.4 | UI просмотра логов | Страница `/logs` с фильтрами |
| 2.10.5 | Retention policy | Автоочистка старых логов |
| 2.10.6 | Экспорт логов | Скачивание для анализа |

#### Структура лога
```typescript
interface AuditLog {
  id: string;
  timestamp: string;
  layer: 'pre' | 'prod';
  action: string;
  method: string;
  request: Record<string, unknown>;
  response: Record<string, unknown>;
  status: 'success' | 'error';
  errorMessage?: string;
  duration: number;
  ip?: string;
}
```

---

### 2.11 База данных

**Приоритет:** Высокий  
**Оценка:** 8 часов

#### Описание
Добавить персистентное хранилище для локальных данных.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.11.1 | Выбор БД | SQLite (локально) или PostgreSQL (prod) |
| 2.11.2 | ORM настройка | Prisma или Drizzle |
| 2.11.3 | Схема данных | Миграции для всех сущностей |
| 2.11.4 | Кэширование | Локальный кэш данных Cyclops |
| 2.11.5 | Синхронизация | Механизм синхронизации с API |

#### Схема
```
┌─────────────────┐     ┌─────────────────┐
│ automation_rules│     │   audit_logs    │
├─────────────────┤     ├─────────────────┤
│ id              │     │ id              │
│ name            │     │ timestamp       │
│ layer           │     │ layer           │
│ trigger_type    │     │ action          │
│ trigger_config  │     │ request         │
│ action_type     │     │ response        │
│ action_config   │     │ status          │
│ enabled         │     │ duration        │
│ created_at      │     └─────────────────┘
└─────────────────┘
                        ┌─────────────────┐
┌─────────────────┐     │   webhooks      │
│  cached_data    │     ├─────────────────┤
├─────────────────┤     │ id              │
│ entity_type     │     │ event_type      │
│ entity_id       │     │ event_id        │
│ layer           │     │ payload         │
│ data            │     │ processed       │
│ updated_at      │     │ received_at     │
└─────────────────┘     └─────────────────┘
```

---

### 2.12 Безопасность

**Приоритет:** Высокий  
**Оценка:** 8 часов

#### Описание
Усилить безопасность приложения.

#### Задачи

| # | Задача | Описание |
|---|--------|----------|
| 2.12.1 | Аутентификация | Логин/пароль или SSO |
| 2.12.2 | Сессии | JWT или cookie sessions |
| 2.12.3 | RBAC | Роли и права доступа |
| 2.12.4 | Rate limiting | Ограничение частоты запросов |
| 2.12.5 | IP whitelist | Ограничение по IP (опционально) |
| 2.12.6 | 2FA | Двухфакторная аутентификация |
| 2.12.7 | Аудит безопасности | Логирование входов и критичных действий |

---

## 3. План реализации

### Фаза 1: Критичный функционал (2 недели)

| Неделя | Задачи | Часы |
|--------|--------|------|
| 1 | 2.1 Загрузка документов | 8 |
| 1 | 2.2 СБП | 6 |
| 1 | 2.3 Шифрование карт | 4 |
| 1 | 2.11 База данных | 8 |
| 2 | 2.4 Webhook'и | 12 |
| 2 | 2.12 Безопасность (базовая) | 8 |

**Итого Фаза 1:** 46 часов

### Фаза 2: Улучшения UX (2 недели)

| Неделя | Задачи | Часы |
|--------|--------|------|
| 3 | 2.5 Детальные страницы | 10 |
| 3 | 2.6 Валидация данных | 6 |
| 3 | 2.9 Обработка ошибок | 6 |
| 4 | 2.7 Автоматизация | 16 |
| 4 | 2.10 Логирование | 8 |

**Итого Фаза 2:** 46 часов

### Фаза 3: Расширенный функционал (1 неделя)

| Неделя | Задачи | Часы |
|--------|--------|------|
| 5 | 2.8 Отчёты и аналитика | 12 |
| 5 | 2.12 Безопасность (расширенная) | 8 |

**Итого Фаза 3:** 20 часов

---

## 4. Сводка: Реализовано vs Требуется

### ✅ Что уже работает

| Функционал | Описание |
|------------|----------|
| Авторизация RSA | Подпись запросов согласно документации |
| Загрузка ключей | Через UI текстом или файлом .pem |
| Хранение ключей | Зашифрованные файлы .keys/*.enc |
| Переключение слоёв | PRE/PROD с индикаторами |
| CRUD бенефициаров | ЮЛ, ИП, ФЛ — создание, список, активация |
| Виртуальные счета | Создание, список, балансы |
| Сделки | Создание с 4 типами получателей, исполнение |
| Платежи | Список, идентификация входящих |
| Настройки | Управление ключами, тест подключения |

### ❌ Что НЕ реализовано

| Функционал | Приоритет | Оценка |
|------------|-----------|--------|
| **Загрузка документов** | 🔴 Высокий | 8ч |
| **Генерация QR СБП** | 🔴 Высокий | 6ч |
| **Шифрование номера карты** | 🔴 Высокий | 4ч |
| **Приём webhook'ов** | 🔴 Высокий | 12ч |
| **База данных** | 🔴 Высокий | 8ч |
| **Аутентификация пользователей** | 🔴 Высокий | 8ч |
| Детальные страницы сущностей | 🟡 Средний | 10ч |
| Валидация ИНН/КПП/счетов | 🟡 Средний | 6ч |
| Работающая автоматизация | 🟡 Средний | 16ч |
| Логирование и аудит | 🟡 Средний | 8ч |
| Retry и обработка ошибок | 🟡 Средний | 6ч |
| Отчёты и экспорт | 🟢 Низкий | 12ч |
| 2FA и расширенная безопасность | 🟢 Низкий | 8ч |

### Общая оценка

| Метрика | Значение |
|---------|----------|
| **Реализовано** | ~40% функционала |
| **Осталось реализовать** | ~112 часов |
| Задачи высокого приоритета | 46 часов |
| Задачи среднего приоритета | 46 часов |
| Задачи низкого приоритета | 20 часов |

---

## 5. Технологический стек

### Текущий
- **Frontend:** Next.js 14, React 18, TypeScript
- **State:** Zustand
- **Styling:** CSS Modules / Inline styles
- **API:** Next.js API Routes

### Рекомендуемые дополнения
- **БД:** Prisma + SQLite (dev) / PostgreSQL (prod)
- **Очереди:** BullMQ + Redis (для webhook'ов и автоматизации)
- **Валидация:** Zod
- **Формы:** React Hook Form
- **Тесты:** Vitest + Playwright
- **CI/CD:** GitHub Actions

---

## 6. Риски и зависимости

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Изменение API Cyclops | Средняя | Высокое | Версионирование, тесты |
| Недоступность тестового слоя | Низкая | Среднее | Моки для разработки |
| Проблемы с подписью | Средняя | Высокое | Детальное логирование |
| Нагрузка webhook'ов | Низкая | Среднее | Очереди, rate limiting |

---

## 7. Приёмка

### Критерии готовности MVP
- [ ] Загрузка документов работает для бенефициаров и сделок
- [ ] СБП QR-коды генерируются и отображаются
- [ ] Выплаты на карту работают с шифрованием
- [ ] Webhook'и принимаются и обрабатываются
- [ ] Базовая аутентификация настроена
- [ ] Все формы имеют валидацию
- [ ] Ошибки отображаются понятно пользователю

### Критерии готовности Production
- [ ] Все задачи Фазы 1-2 выполнены
- [ ] Покрытие тестами >70%
- [ ] Документация актуальна
- [ ] Проведено нагрузочное тестирование
- [ ] Security audit пройден
- [ ] Логирование и мониторинг настроены

---

## Приложение A: API методы Cyclops

### ✅ Реализованные методы

| Метод | Описание | Используется в |
|-------|----------|----------------|
| `echo` | Тест подключения | Настройки |
| `create_beneficiary_ul` | Создание бенефициара ЮЛ | /beneficiaries/new |
| `create_beneficiary_ip` | Создание бенефициара ИП | /beneficiaries/new |
| `create_beneficiary_fl` | Создание бенефициара ФЛ | /beneficiaries/new |
| `list_beneficiary` | Список бенефициаров | /beneficiaries |
| `activate_beneficiary` | Активация | /beneficiaries |
| `deactivate_beneficiary` | Деактивация | /beneficiaries |
| `create_virtual_account` | Создание виртуального счёта | /virtual-accounts |
| `list_virtual_account` | Список счетов | /virtual-accounts |
| `get_virtual_account` | Детали счёта | /virtual-accounts |
| `create_deal` | Создание сделки | /deals/new |
| `list_deals` | Список сделок | /deals |
| `execute_deal` | Исполнение сделки | /deals |
| `rejected_deal` | Отмена сделки | /deals |
| `list_payments_v2` | Список платежей | /payments |
| `identification_payment` | Идентификация платежа | /payments |
| `list_banks_sbp` | Список банков СБП | /deals/new |

### ❌ НЕ реализованные методы

| Метод | Описание | Требуется для |
|-------|----------|---------------|
| `get_beneficiary` | Детали бенефициара | Детальная страница |
| `get_deal` | Детали сделки | Детальная страница |
| `get_payment` | Детали платежа | Детальная страница |
| `update_deal` | Обновление сделки | Корректировка |
| `cancel_deal` | Отмена сделки до исполнения | Управление сделками |
| `generate_qr_sbp` | Генерация QR-кода СБП | Приём платежей |
| `refund_payment` | Возврат платежа | Управление платежами |
| `transfer_between_virtual_accounts` | Перевод между счетами | Работает, но не тестировался |
| **Документы:** | | |
| `upload_document` | Загрузка документа | Документы бенефициара/сделки |
| `list_documents` | Список документов | Просмотр документов |
| `get_document` | Скачивание документа | Просмотр документов |
| **Дополнительно:** | | |
| `generate_payment_order` | Генерация платёжного поручения | Отчётность |
| `get_statement` | Выписка по счёту | Отчётность |

---

## Приложение B: Структура директорий (целевая)

```
cyclops-dashboard/
├── app/
│   ├── (auth)/
│   │   ├── login/
│   │   └── logout/
│   ├── (dashboard)/
│   │   ├── beneficiaries/
│   │   │   ├── [id]/
│   │   │   └── new/
│   │   ├── virtual-accounts/
│   │   │   └── [id]/
│   │   ├── deals/
│   │   │   ├── [id]/
│   │   │   └── new/
│   │   ├── payments/
│   │   │   └── [id]/
│   │   ├── sbp/
│   │   ├── documents/
│   │   ├── automation/
│   │   ├── reports/
│   │   ├── logs/
│   │   └── settings/
│   └── api/
│       ├── auth/
│       ├── cyclops/
│       ├── documents/
│       ├── webhooks/
│       ├── keys/
│       └── automation/
├── components/
│   ├── ui/
│   ├── forms/
│   ├── tables/
│   ├── charts/
│   └── layout/
├── lib/
│   ├── cyclops-client.ts
│   ├── crypto.ts
│   ├── validators.ts
│   ├── db.ts
│   └── queue.ts
├── prisma/
│   └── schema.prisma
├── hooks/
├── types/
└── tests/
```
